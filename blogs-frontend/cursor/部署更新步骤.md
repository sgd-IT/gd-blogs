# 服务器更新步骤（解决显示旧版本问题）

## 问题现象
- 本地访问 `localhost:3000` 显示：**"你好，我是 木东"**（中文，新版本）✅
- 服务器访问 `119.91.150.19` 显示：**"MY NAME IS Gdblogs"**（英文，旧版本）❌

## 原因分析
服务器上运行的是旧版本的构建产物，需要：
1. 上传最新代码
2. **重新构建**（最关键！）
3. **重启服务**

## 完整更新步骤

### 方法一：在服务器上直接操作（推荐）

```bash
# 1. SSH 登录服务器
ssh root@119.91.150.19

# 2. 进入项目目录
cd /www/wwwroot/gdblogs/blogs-frontend

# 3. 停止当前服务
pm2 stop gdblogs-frontend
# 或者如果直接运行：找到进程并 kill
ps aux | grep "node.*start"
kill <进程ID>

# 4. 备份当前版本（可选但推荐）
cp -r .next .next.backup.$(date +%Y%m%d_%H%M%S)

# 5. 拉取最新代码（如果使用 git）
git pull origin master
# 或者手动上传最新代码后，确认文件已更新
ls -lh src/components/desktop/OrbitingIntroduction.tsx

# 6. 验证代码是否为中文版本
grep "你好，我是" src/components/desktop/OrbitingIntroduction.tsx
# 应该输出包含 "你好，我是" 的行，如果没有，说明代码没更新

# 7. 安装依赖（如果有新依赖）
npm install

# 8. 删除旧构建（重要！）
rm -rf .next

# 9. 重新构建（必须执行！）
npm run build

# 10. 验证构建结果
# 检查构建时间
ls -lh .next/
# 检查构建ID
cat .next/BUILD_ID

# 11. 启动服务
pm2 start npm --name gdblogs-frontend -- start
# 或者
pm2 restart gdblogs-frontend

# 12. 查看服务状态和日志
pm2 list
pm2 logs gdblogs-frontend --lines 50

# 13. 测试访问
curl http://localhost:3000 | grep -o "你好，我是" | head -1
# 如果输出 "你好，我是"，说明更新成功
```

### 方法二：本地构建后上传

```bash
# 1. 在本地项目目录
cd blogs-frontend

# 2. 确保代码是最新的
git status
git pull  # 如果需要

# 3. 安装依赖
npm install

# 4. 构建项目
npm run build

# 5. 验证构建结果
ls -lh .next/
cat .next/BUILD_ID

# 6. 上传以下文件到服务器：
#    - 整个项目目录（包括 .next、node_modules、src、public 等）
#    或者只上传：
#    - .next/ 目录（必须）
#    - node_modules/ 目录（必须）
#    - package.json（必须）
#    - public/ 目录（必须）
#    - src/ 目录（如果代码有更新）

# 7. 在服务器上执行
cd /www/wwwroot/gdblogs/blogs-frontend
pm2 stop gdblogs-frontend
pm2 restart gdblogs-frontend
# 或
pm2 start npm --name gdblogs-frontend -- start
```

## 验证更新是否成功

### 1. 检查服务器文件
```bash
# 检查源码文件
grep "你好，我是" src/components/desktop/OrbitingIntroduction.tsx

# 检查构建文件
grep -r "你好，我是" .next/static/ 2>/dev/null | head -3
```

### 2. 检查服务运行
```bash
# 查看 PM2 状态
pm2 list

# 查看日志
pm2 logs gdblogs-frontend --lines 20

# 检查端口
netstat -tuln | grep 3000
```

### 3. 浏览器测试
1. 清除浏览器缓存（Ctrl + Shift + Delete）
2. 使用无痕模式访问 `http://119.91.150.19`
3. 查看页面是否显示 **"你好，我是 木东"**

## 常见问题

### Q1: 构建后还是显示旧版本？
**A:** 检查以下几点：
- 确认 `.next` 目录被完全删除后重新构建
- 确认服务已重启（`pm2 restart`）
- 清除浏览器缓存
- 检查是否有多个 Next.js 进程在运行

### Q2: 如何确认代码已更新？
**A:** 运行以下命令：
```bash
# 检查源码
grep -n "你好，我是" src/components/desktop/OrbitingIntroduction.tsx

# 检查构建产物
find .next -name "*.js" -exec grep -l "你好，我是" {} \; | head -3
```

### Q3: PM2 重启后还是旧版本？
**A:** 尝试完全停止后重新启动：
```bash
pm2 delete gdblogs-frontend
pm2 start npm --name gdblogs-frontend -- start
```

### Q4: 构建时间很长？
**A:** 这是正常的，Next.js 构建需要时间。确保：
- 服务器有足够内存
- 网络连接正常（如果需要下载依赖）

## 快速命令总结

```bash
# 一键更新（在服务器上）
cd /www/wwwroot/gdblogs/blogs-frontend && \
pm2 stop gdblogs-frontend && \
git pull && \
npm install && \
rm -rf .next && \
npm run build && \
pm2 restart gdblogs-frontend && \
pm2 logs gdblogs-frontend --lines 20
```

## 注意事项

1. **必须重新构建**：只上传代码文件不会生效，必须运行 `npm run build`
2. **必须重启服务**：构建后必须重启 Next.js 服务
3. **清除缓存**：浏览器和 Nginx（如果有）的缓存可能影响显示
4. **检查文件权限**：确保 `.next` 目录有正确的读取权限
5. **备份重要**：更新前备份 `.next` 目录，以防出现问题可以快速回滚
