# 完整更新流程 - 确保显示新版本

## 问题确认
访问 `http://119.91.150.19` 还是显示旧版本（英文 "MY NAME IS Gdblogs"），而不是新版本（中文 "你好，我是 木东"）。

## 完整解决步骤

### 第一步：在服务器上验证代码是否已更新

```bash
# 1. 进入项目目录
cd /www/wwwroot/gdblogs/blogs-frontend

# 2. 检查源码文件是否为中文版本
grep "你好，我是" src/components/desktop/OrbitingIntroduction.tsx

# 如果输出为空，说明代码没更新，需要重新上传代码
# 如果有输出，说明代码已更新，继续下一步
```

### 第二步：停止服务

**方法一：在宝塔面板中停止**
1. 进入 PM2 管理器
2. 找到 `frontend` 项目
3. 点击"停止"按钮

**方法二：使用命令行停止**
```bash
pm2 stop gdblogs-frontend
# 或者
pm2 stop all
```

### 第三步：删除旧构建并重新构建

```bash
# 1. 进入项目目录
cd /www/wwwroot/gdblogs/blogs-frontend

# 2. 备份旧构建（可选）
mv .next .next.backup.$(date +%Y%m%d_%H%M%S)

# 3. 删除旧构建（重要！）
rm -rf .next

# 4. 重新构建
npm run build

# 5. 验证构建结果
grep -r "你好，我是" .next/static/ 2>/dev/null | head -3

# 如果找到中文内容，说明构建成功
```

### 第四步：重启服务

**方法一：在宝塔面板中重启**
1. 在 PM2 管理器中
2. 找到 `frontend` 项目
3. 点击"重启"按钮

**方法二：使用命令行重启**
```bash
pm2 restart gdblogs-frontend
# 或者如果进程不存在
pm2 start npm --name gdblogs-frontend -- start
pm2 save
```

### 第五步：验证更新

```bash
# 1. 检查服务状态
pm2 list

# 2. 查看日志
pm2 logs gdblogs-frontend --lines 20

# 3. 测试本地访问
curl http://localhost:3000 | grep -o "你好，我是" | head -1

# 如果输出 "你好，我是"，说明更新成功
```

### 第六步：清除浏览器缓存

1. 按 `Ctrl + Shift + Delete` 清除浏览器缓存
2. 或使用无痕模式访问 `http://119.91.150.19`
3. 或按 `Ctrl + F5` 强制刷新

## 一键更新脚本

```bash
#!/bin/bash
cd /www/wwwroot/gdblogs/blogs-frontend

# 停止服务
pm2 stop gdblogs-frontend

# 验证代码
if ! grep -q "你好，我是" src/components/desktop/OrbitingIntroduction.tsx; then
    echo "错误：代码不是中文版本，请先上传最新代码！"
    exit 1
fi

# 删除旧构建
rm -rf .next

# 重新构建
npm run build

# 验证构建
if grep -r "你好，我是" .next/static/ 2>/dev/null | head -1 > /dev/null; then
    echo "✓ 构建成功，包含中文内容"
else
    echo "⚠ 警告：构建产物中未找到中文内容"
fi

# 重启服务
pm2 restart gdblogs-frontend

# 等待几秒
sleep 3

# 测试
curl http://localhost:3000 | grep -o "你好，我是" | head -1 && echo "✓ 更新成功！" || echo "✗ 更新可能失败，请检查日志"
```

## 常见问题排查

### Q1: 构建后还是旧版本？
**A:** 检查：
- 是否删除了 `.next` 目录
- 服务是否重启
- 浏览器缓存是否清除

### Q2: 服务重启后还是旧版本？
**A:** 尝试：
```bash
# 完全删除并重新启动
pm2 delete gdblogs-frontend
pm2 start npm --name gdblogs-frontend -- start
```

### Q3: 如何确认代码已更新？
**A:** 运行：
```bash
grep -n "你好，我是" src/components/desktop/OrbitingIntroduction.tsx
```

### Q4: 如何确认构建已更新？
**A:** 运行：
```bash
# 检查构建时间
ls -lh .next/

# 检查构建ID
cat .next/BUILD_ID

# 检查构建产物内容
grep -r "你好，我是" .next/static/ 2>/dev/null | head -3
```
